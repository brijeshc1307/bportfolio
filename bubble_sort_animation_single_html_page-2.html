<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bubble Sort — Interactive Animation</title>
  <style>
    :root{
      --bg:#0f172a;
      --panel:#111827;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --accent:#22d3ee;
      --compare:#f97316;
      --swap:#ef4444;
      --sorted:#22c55e;
      --bar:#60a5fa;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:radial-gradient(1200px 600px at 70% -10%,#1e293b 0%,var(--bg) 60%);color:var(--text)}
    header{padding:24px 16px 8px;text-align:center}
    h1{margin:0;font-size:clamp(22px,3vw,32px);letter-spacing:.3px}
    .sub{color:var(--muted);font-size:14px;margin-top:6px}
    .wrap{max-width:1100px;margin:0 auto;padding:12px 16px 28px}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(148,163,184,.12);border-radius:18px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:center}
    .control{background:var(--panel);border:1px solid rgba(148,163,184,.15);color:var(--text);padding:10px 12px;border-radius:12px;display:flex;align-items:center;gap:10px}
    .control label{font-size:12px;color:var(--muted)}
    .control input[type="range"]{width:160px}
    .btn{cursor:pointer;border:none;border-radius:12px;padding:10px 14px;font-weight:600;background:linear-gradient(90deg,var(--accent),#3b82f6);color:#002230;letter-spacing:.2px;transition:transform .08s ease,filter .2s ease}
    .btn:hover{filter:brightness(1.05)}
    .btn:active{transform:scale(.98)}
    .btn.secondary{background:#1f2937;color:var(--text);border:1px solid rgba(148,163,184,.18)}
    .btn.ghost{background:transparent;border:1px dashed rgba(148,163,184,.3);color:var(--muted)}
    .stage{height:380px;position:relative;margin-top:16px;background:rgba(2,6,23,.35);border:1px solid rgba(148,163,184,.12);border-radius:18px;padding:10px;overflow:hidden}
    .bars{position:absolute;inset:10px;display:flex;align-items:flex-end;gap:4px;width:calc(100% - 20px)}
    .bar{flex:1 1 auto;background:linear-gradient(180deg,rgba(255,255,255,.25),rgba(255,255,255,.05)),var(--bar);border-radius:8px 8px 4px 4px;height:10px;transition:height .25s ease,background .15s ease,transform .25s ease;position:relative;display:flex;align-items:flex-start;justify-content:center}
    .bar span{position:absolute;top:-18px;font-size:10px;color:var(--text)}
    .bar.compare{background:var(--compare)}
    .bar.swap{background:var(--swap)}
    .bar.sorted{background:var(--sorted)}
    .legend{display:flex;gap:14px;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:10px;color:var(--muted);font-size:12px}
    .key{display:flex;gap:6px;align-items:center}
    .dot{width:12px;height:12px;border-radius:50%}
    .dot.bar{background:var(--bar)}
    .dot.compare{background:var(--compare)}
    .dot.swap{background:var(--swap)}
    .dot.sorted{background:var(--sorted)}
    .footer{margin-top:16px;color:var(--muted);font-size:12px;text-align:center}
    .metrics{display:flex;gap:14px;justify-content:center;margin-top:10px;font-variant-numeric:tabular-nums}
    .metric{background:rgba(148,163,184,.08);border:1px solid rgba(148,163,184,.15);padding:6px 10px;border-radius:10px}
  </style>
</head>
<body>
  <header>
    <h1>Bubble Sort — Interactive Visualizer</h1>
    <div class="sub">Compare, swap, and watch the array get sorted. Pause, step, tweak speed & size.</div>
  </header>
  <div class="wrap">
    <div class="panel">
      <div class="controls">
        <div class="control">
          <label>Size</label>
          <input id="size" type="range" min="5" max="120" value="40" />
          <span id="sizeVal">40</span>
        </div>
        <div class="control">
          <label>Speed</label>
          <input id="speed" type="range" min="1" max="100" value="70" />
          <span id="speedVal">70</span>
        </div>
        <div class="control">
          <label>Distribution</label>
          <select id="dist">
            <option value="random">Random</option>
            <option value="nearly">Nearly Sorted</option>
            <option value="rev">Reverse</option>
            <option value="few">Few Unique</option>
          </select>
        </div>
        <button id="gen" class="btn secondary" title="Generate a new array">Generate</button>
        <button id="start" class="btn" title="Start / Pause">Start</button>
        <button id="step" class="btn ghost" title="Do one comparison/swap">Step</button>
        <button id="reset" class="btn ghost" title="Reset to fresh array">Reset</button>
      </div>
      <div class="stage">
        <div id="bars" class="bars" aria-label="array bars"></div>
      </div>
      <div class="legend">
        <div class="key"><span class="dot bar"></span>Default</div>
        <div class="key"><span class="dot compare"></span>Comparing</div>
        <div class="key"><span class="dot swap"></span>Swapping</div>
        <div class="key"><span class="dot sorted"></span>Sorted</div>
      </div>
      <div class="metrics">
        <div class="metric">Comparisons: <span id="cmp">0</span></div>
        <div class="metric">Swaps: <span id="swp">0</span></div>
        <div class="metric">Pass: <span id="pass">1</span></div>
      </div>
      <div class="footer">Time complexity (worst): O(n²) · Stable: Yes · In‑place: Yes</div>
    </div>
  </div>
  <script>
    const barsEl = document.getElementById('bars');
    const sizeEl = document.getElementById('size');
    const speedEl = document.getElementById('speed');
    const distEl = document.getElementById('dist');
    const sizeVal = document.getElementById('sizeVal');
    const speedVal = document.getElementById('speedVal');
    const cmpEl = document.getElementById('cmp');
    const swpEl = document.getElementById('swp');
    const passEl = document.getElementById('pass');
    const btnGen = document.getElementById('gen');
    const btnStart = document.getElementById('start');
    const btnStep = document.getElementById('step');
    const btnReset = document.getElementById('reset');

    let arr = [];
    let bars = [];
    let sortedBoundary = 0;
    let j = 0;
    let passIdx = 1;
    let running = false;
    let passSwapped = false;
    let comparisons = 0;
    let swaps = 0;

    function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
    function generateArray(n,mode='random'){
      const vals=[];
      if(mode==='random'){
        for(let i=0;i<n;i++) vals.push(rand(5,100));
      } else if(mode==='rev'){
        for(let i=n;i>=1;i--) vals.push(Math.max(5,Math.floor(i/n*100)));
      } else if(mode==='nearly'){
        for(let i=1;i<=n;i++) vals.push(Math.floor(i/n*100));
        for(let k=0;k<Math.max(3,Math.floor(n*0.05));k++){
          const a=rand(0,n-1),b=rand(0,n-1);[vals[a],vals[b]]=[vals[b],vals[a]];
        }
      } else if(mode==='few'){
        const choices=[15,35,55,75,95];
        for(let i=0;i<n;i++) vals.push(choices[rand(0,choices.length-1)]);
      }
      return vals;
    }

    function renderBars(){
      barsEl.innerHTML='';
      bars=arr.map(v=>{
        const el=document.createElement('div');
        el.className='bar';
        el.style.height=`${v*3}px`;
        const label=document.createElement('span');
        label.textContent=v;
        el.appendChild(label);
        barsEl.appendChild(el);
        return el;
      });
      [...bars].forEach(b=>b.classList.remove('sorted','swap','compare'));
    }

    function setSize(n){
      sizeVal.textContent=n;
      arr=generateArray(n,distEl.value);
      sortedBoundary=arr.length;j=0;passIdx=1;passSwapped=false;
      comparisons=0;swaps=0;
      updateMetrics();
      renderBars();
    }

    function updateMetrics(){cmpEl.textContent=comparisons;swpEl.textContent=swaps;passEl.textContent=passIdx;}
    function sleepBySpeed(){const s=+speedEl.value;const delay=10+Math.floor(1000*Math.pow(1-s/100,2));return new Promise(res=>setTimeout(res,delay));}
    function clearHighlights(){if(bars[j]) bars[j].classList.remove('compare','swap');if(bars[j+1]) bars[j+1].classList.remove('compare','swap');}
    function markSorted(idx){if(bars[idx]) bars[idx].classList.remove('compare','swap');if(bars[idx]) bars[idx].classList.add('sorted');}

    async function stepOnce(){
      if(sortedBoundary<=1){if(sortedBoundary===1){markSorted(0);sortedBoundary=0;}running=false;btnStart.textContent='Start';return false;}
      bars[j].classList.add('compare');bars[j+1].classList.add('compare');comparisons++;updateMetrics();
      await sleepBySpeed();
      if(arr[j]>arr[j+1]){
        bars[j].classList.remove('compare');bars[j+1].classList.remove('compare');bars[j].classList.add('swap');bars[j+1].classList.add('swap');
        await sleepBySpeed();
        [arr[j],arr[j+1]]=[arr[j+1],arr[j]];
        bars[j].style.height=`${arr[j]*3}px`;bars[j].querySelector('span').textContent=arr[j];
        bars[j+1].style.height=`${arr[j+1]*3}px`;bars[j+1].querySelector('span').textContent=arr[j+1];
        swaps++;passSwapped=true;updateMetrics();
      }
      clearHighlights();
      j++;
      if(j>=sortedBoundary-1){
        markSorted(sortedBoundary-1);
        sortedBoundary--;
        if(!passSwapped){for(let k=sortedBoundary-1;k>=0;k--) markSorted(k);sortedBoundary=0;running=false;btnStart.textContent='Start';return false;}
        passSwapped=false;j=0;passIdx++;updateMetrics();
      }
      return true;
    }

    async function run(){running=true;btnStart.textContent='Pause';while(running){const cont=await stepOnce();if(!cont) break;}}
    function pause(){running=false;btnStart.textContent='Start';}
    function reset(){setSize(+sizeEl.value);}

    sizeEl.addEventListener('input',e=>{sizeVal.textContent=e.target.value;});
    sizeEl.addEventListener('change',()=>setSize(+sizeEl.value));
    speedEl.addEventListener('input',e=>{speedVal.textContent=e.target.value;});
    distEl.addEventListener('change',()=>setSize(+sizeEl.value));
    btnGen.addEventListener('click',()=>setSize(+sizeEl.value));
    btnReset.addEventListener('click',reset);
    btnStart.addEventListener('click',()=>{if(running){pause();}else{run();}});
    btnStep.addEventListener('click',async()=>{if(running) return;await stepOnce();});
    setSize(+sizeEl.value);
  </script>
</body>
</html>
